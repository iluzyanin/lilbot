function random(t,e){return Math.floor(Math.random()*(e-t)+t)}function randomSign(){return Math.random()-.5>0?-1:1}!async function(t,e){const o=t.getElementById("gameboard"),n=o.getContext("2d"),i=new URLSearchParams(t.location.search.substring(1)),a=i.get("orgName")||"Headquarters",r=i.get("botName")||"bot";let f,d;let s,c,l;let h,u,m,w,x,y,g,p,S,b,A=0;function L(){f={width:o.width,height:o.height-40},d=0,s={x:f.width/2-10,y:f.height-16},l=new Set,u=1.1,h=Date.now(),m=new Set,x=1,w=.3,y=Date.now()-1500,g=new Set,p=!1,S=!1,b=0}function k(){R(),D(),v("",10,12),n.font="400 16px monospace",n.fillStyle="black",n.fillText(b,39,25),A>0&&n.fillText(`HI ${A}`,10,45),function(){("ArrowLeft"===c&&s.x+d>0||"ArrowRight"===c&&s.x+d<f.width-22)&&(s.x+=d);v("",s.x,s.y)}(),function(){if((Date.now()-h)/1e3<1/u)return;h=Date.now(),l.add({x:s.x,y:f.height-16})}(),function(){for(const t of l)T(t)}(),function(){(Date.now()-y)/1e3>1/x&&(m.add({x:random(30,f.width-30),y:-20}),y=Date.now());for(const t of m)F(t)}(),function(){for(const t of g)M(t)}(),S||requestAnimationFrame(k)}function T(t){t.y<-10?l.delete(t):(t.y-=5,v("",t.x,t.y))}function v(t,e,o,i){n.font="600 16px FontAwesome",n.fillStyle=i||"black",n.fillText(t,e,o+12)}function R(){n.fillStyle="#fff",n.fillRect(0,0,f.width,f.height+40)}function D(){n.strokeStyle="#999",n.lineJoin="round",n.strokeRect(5,f.height,f.width-10,30),v("",f.width-30,f.height+8,"#999")}function F(t){if(t.y+=w,t.y>f.height-16)return m.delete(t),S=!0,A=b>A?b:A,void setTimeout((()=>{R(),function(){D();H([{from:a,text:`You answered ${b} messages`,y:10,isLeft:!0},{from:"",text:I(),y:50,isLeft:!0},{from:r,text:"Got it!",y:110},{from:a,text:"Press any key to play again!",y:170,isLeft:!0}]),L()}()}),1e3);for(const e of l)if(e.x>t.x-16&&e.x<t.x+16&&e.y>t.y-5&&e.y<t.y+5)return m.delete(t),l.delete(e),E(t.x,t.y),void B();v("",t.x,t.y)}function B(){b+=1,b%10==0&&(x<2.5&&(x+=.05),w<1&&(w+=.05),u<3&&(u+=.1))}function E(t,e){for(let o=0;o<10;o++)g.add({x:t,y:e,dx:randomSign()*random(1,3),dy:randomSign()*random(1,3),alpha:1})}function M(t){t.alpha-=.05,t.alpha<=0?g.delete(t):(t.x+=t.dx,t.y+=t.dy,n.font="8px FontAwesome",n.fillStyle="black",n.save(),n.globalAlpha=t.alpha,n.fillText("",t.x,t.y+12),n.restore())}function H(t){t.forEach(((t,e)=>setTimeout((()=>{p||function({from:t,text:e,y:o,isLeft:i}){const a=10;n.fillStyle="black",n.font="600 10px monospace";const r=n.measureText(t);n.fillText(t,i?a:f.width-r.width-a,o+r.actualBoundingBoxAscent),n.strokeStyle="#999",n.lineJoin="round",n.font="12px monospace";const d=n.measureText(e);n.fillText(e,i?2*a:f.width-d.width-2*a,o+d.actualBoundingBoxAscent+2*a+4),n.strokeRect(i?a:f.width-d.width-30,o+12,d.width+20,35)}(t)}),1500*e)))}function I(){return b<50?"You can do better!":b<150?"Not bad!":b<300?"Great work!":b<600?"Awesome!":"Impossible!"}t.addEventListener("keydown",(function(t){if(!p)return p=!0,void k();"ArrowLeft"===t.code&&(c=t.code,d=-5);"ArrowRight"===t.code&&(c=t.code,d=5)})),t.addEventListener("keyup",(function(t){["ArrowLeft","ArrowRight"].includes(t.code)&&(c=void 0)}));const N=new FontFace("FontAwesome",'url("https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/fonts/fontawesome-webfont.woff2?v=4.5.0")');let P;await N.load(),t.fonts.add(N);const W=()=>{P&&e.clearTimeout(P),P=setTimeout((()=>{S=!0,setTimeout((()=>{o.height=Math.max(e.innerHeight,600),o.width=Math.min(e.innerWidth,580),L(),R(),D(),H([{from:a,text:`Hey, ${r}!`,y:10,isLeft:!0},{from:r,text:"What's up?",y:70},{from:a,text:"We need help answering messages!",y:130,isLeft:!0},{from:r,text:"Sure thing!",y:200},{from:a,text:"Press any key when ready!",y:260,isLeft:!0}])}),50)}),500)};e.addEventListener("resize",W),W()}(document,window);

function random(t,e){return Math.floor(Math.random()*(e-t)+t)}function randomSign(){return Math.random()-.5>0?-1:1}!async function(t,e){const o=t.getElementById("gameboard"),n=o.getContext("2d"),i=new URLSearchParams(t.location.search.substring(1)),a=i.get("orgName")||"Headquarters",r=i.get("botName")||"bot",f=40,d="",s="",c="",l="",h="",u="";let w,x;const y=5;let m,g,p;const S=5;let b,A,L,k,T,v,R,D,F,B,E=0;function M(){x=0,m={x:w.width/2-10,y:w.height-16},p=new Set,A=1.5,b=Date.now(),L=new Set,T=1,k=.3,v=Date.now()-1500,R=new Set,D=!1,F=!1,B=0}function H(){P(),W(),N(h,10,12),n.font="400 16px monospace",n.fillStyle="black",n.fillText(B,39,25),E>0&&n.fillText(`HI ${E}`,10,45),function(){("ArrowLeft"===g&&m.x+x>0||"ArrowRight"===g&&m.x+x<w.width-22)&&(m.x+=x);N(d,m.x,m.y)}(),function(){if((Date.now()-b)/1e3<1/A)return;b=Date.now(),p.add({x:m.x,y:w.height-16})}(),function(){for(const t of p)I(t)}(),function(){(Date.now()-v)/1e3>1/T&&(L.add({x:random(30,w.width-30),y:-20}),v=Date.now());for(const t of L)$(t)}(),function(){for(const t of R)J(t)}(),F||requestAnimationFrame(H)}function I(t){t.y<-10?p.delete(t):(t.y-=S,N(s,t.x,t.y))}function N(t,e,o,i){n.font="600 16px FontAwesome",n.fillStyle=i||"black",n.fillText(t,e,o+12)}function P(){n.fillStyle="#fff",n.fillRect(0,0,w.width,w.height+f)}function W(){n.strokeStyle="#999",n.lineJoin="round",n.strokeRect(5,w.height,w.width-10,f-10),N(l,w.width-30,w.height+8,"#999")}function $(t){if(t.y+=k,t.y>w.height-16)return L.delete(t),F=!0,E=B>E?B:E,void setTimeout(()=>{P(),W(),Y([{from:a,text:`You answered ${B} messages`,y:10,isLeft:!0},{from:"",text:z(),y:50,isLeft:!0},{from:r,text:"Got it!",y:110},{from:a,text:"Press any key to play again!",y:170,isLeft:!0}]),M()},1e3);for(const e of p)if(e.x>t.x-16&&e.x<t.x+16&&e.y>t.y-5&&e.y<t.y+5)return L.delete(t),p.delete(e),G(t.x,t.y),void q();N(c,t.x,t.y)}function q(){(B+=1)%10==0&&(T<2.5&&(T+=.05),k<1&&(k+=.05),A<3&&(A+=.05))}function G(t,e){for(let o=0;o<10;o++)R.add({x:t,y:e,dx:randomSign()*random(1,3),dy:randomSign()*random(1,3),alpha:1})}function J(t){t.alpha-=.05,t.alpha<=0?R.delete(t):(t.x+=t.dx,t.y+=t.dy,n.font="8px FontAwesome",n.fillStyle="black",n.save(),n.globalAlpha=t.alpha,n.fillText(u,t.x,t.y+12),n.restore())}function Y(t){console.log("start!",t),t.forEach((t,e)=>setTimeout(()=>{D||function({from:t,text:e,y:o,isLeft:i}){n.fillStyle="black",n.font="600 10px monospace";const a=n.measureText(t);n.fillText(t,i?10:w.width-a.width-10,o+a.actualBoundingBoxAscent),n.strokeStyle="#999",n.lineJoin="round",n.font="12px monospace";const r=n.measureText(e);n.fillText(e,i?20:w.width-r.width-20,o+r.actualBoundingBoxAscent+20+4),n.strokeRect(i?10:w.width-r.width-30,o+12,r.width+20,35)}(t)},1500*e))}function z(){return B<50?"You can do better!":B<150?"Not bad!":B<300?"Great work!":B<600?"Awesome!":"Impossible!"}t.addEventListener("keydown",function(t){if(!D)return D=!0,void H();"ArrowLeft"===t.code&&(g=t.code,x=-y);"ArrowRight"===t.code&&(g=t.code,x=y)}),t.addEventListener("keyup",function(t){["ArrowLeft","ArrowRight"].includes(t.code)&&(g=void 0)});const C=new FontFace("FontAwesome",'url("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0")');await C.load(),t.fonts.add(C);const U=()=>{o.height=Math.max(e.innerHeight,600),o.width=Math.min(e.innerWidth,580),w={width:o.width,height:o.height-f},P(),M(),W(),Y([{from:a,text:`Hey, ${r}!`,y:10,isLeft:!0},{from:r,text:"What's up?",y:70},{from:a,text:"We need help answering messages!",y:130,isLeft:!0},{from:r,text:"Sure thing!",y:200},{from:a,text:"Press any key when ready!",y:260,isLeft:!0}])};e.addEventListener("resize",U),U()}(document,window);